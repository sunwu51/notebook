---
title: å‘å¸ƒå‰ç«¯ç»„ä»¶çš„æ­¥éª¤
date: 2024-07-03 20:28:00
tags:
    - å‰ç«¯
    - ç»„ä»¶
    - component
    - react
    - camel-ui
---
# 1 èƒŒæ™¯
æˆ‘ä¹‹å‰å°è£…äº†åå‡ ä¸ª`react`ç»„ä»¶ï¼Œåé¢æƒ³åœ¨å…¶ä»–çš„ä¸ªäººé¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦æŠŠå¼€å‘å¥½çš„`ç»„ä»¶åº“`å‘å¸ƒåˆ°npmä¸Šã€‚

æœ¬æ–‡è®²ä¸€ä¸‹éƒ½éœ€è¦å“ªäº›æ­¥éª¤ï¼Œç»„ä»¶ä»¥`vite + react`è¿›è¡Œå¼€å‘çš„ï¼Œå¦‚æœæ˜¯å…¶ä»–æ‰“åŒ…å·¥å…·æµç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚

# 2 æµç¨‹
é¦–å…ˆå‡è®¾ä½ å·²ç»å¼€å‘å¥½äº†ç»„ä»¶ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ä½¿ç”¨çš„`vite + react`ï¼Œ

## 2.1 package.json
ä¿®æ”¹`package.json`å¦‚ä¸‹ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªå…¥å£æ–‡ä»¶è¿˜æœ‰`.d.ts`è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œæˆ‘ä»¬åé¢ä¼šä»‹ç»å¦‚ä½•åˆ›å»ºã€‚
```json :package.json {2,6,7}
{
  "name": "@sunwu51/camel-ui",   // å…ˆåˆ°npmä¸Šæœä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰åŒåçš„ï¼Œä¿é™©çš„æ–¹æ¡ˆå°±æ˜¯@username/xxx
  "version": "0.0.1",
  "type": "module",
  "main": "dist/camel.umd.js",   // umdæ¨¡å¼ä¸‹çš„ import requireç”¨è¿™ä¸ªæ–‡ä»¶
  "module": "dist/camel.es.js",  // esæ¨¡å¼ä¸‹ import requireç”¨è¿™ä¸ªï¼Œè¿™ä¸ªæ¯”è¾ƒé‡è¦ï¼Œå‰ç«¯å¼€å‘éƒ½åªç”¨es
  "types": "dist/types/index.d.ts",  // ç±»å‹å£°æ˜çš„d.tsæ–‡ä»¶ï¼Œæ–¹ä¾¿åˆ«äººå¼•å…¥æä¾›æ™ºèƒ½æç¤º
  "keywords": [                  // npmçš„å…³é”®å­—ï¼Œå¯æœ‰å¯æ— 
    "react",
    "component",
    "react-aria",
    "camel-ui"
  ],
  "author": "Frank",           // ä½œè€… è¯ä¹¦ gitä»“åº“ï¼Œ å¯æœ‰å¯æ— 
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/sunwu51/camel-ui.git"
  },
  "publishConfig": {          // å£°æ˜æ˜¯publicçš„ï¼Œå¸¦@usernameçš„é»˜è®¤æ˜¯private
    "access": "public"
  },
  "files": [                  // éœ€è¦ä¸Šä¼ åˆ°npmçš„æ–‡ä»¶ï¼Œåªä¸Šä¼ distå³å¯srcç­‰ä¸éœ€è¦
    "dist"
  ],
  "scripts": {
    //...
  },
  "dependencies": {
    //...
  },
  "peerDependencies": {     // æŠŠreact react-domä»dependenciesç§»åˆ°peerDependeniesï¼Œ
    "react": "^18.2.0",     // é¡¹ç›®ä¸­ä¼šè‡ªå·±å¼•å…¥ï¼Œä¸è¦åœ¨ç»„ä»¶åº“å¼•å…¥
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    // ...
  }
}
```
## 2.2 `types.ts`ä¸`index.d.ts`
ä¸€èˆ¬è€Œè¨€å¼€å‘ç»„ä»¶åº“ï¼Œæœ€å¥½ä½¿ç”¨`ts`å¹¶é…æœ‰ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰èƒ½æœ‰æ¯ä¸ªç»„ä»¶çš„å±æ€§æ™ºèƒ½æç¤ºã€‚å½“ç„¶æˆ‘ä»¬è¿˜è¦æŠŠè¿™äº›ç±»å‹å£°æ˜å‡ºå»æ‰èƒ½è¢«ä½¿ç”¨ã€‚

é¦–å…ˆåˆ›å»º`type.ts`ï¼ŒæŠŠç»„ä»¶çš„å„ç§`props`å±æ€§è¿›è¡Œå£°æ˜å¦‚ä¸‹ï¼š
```ts :type.ts

......

export interface ButtonProps extends BaseProps, AriaButtonOptions<'button'> {}
export interface BadgeProps extends BaseProps {}
export interface CardProps extends BaseProps {}
export interface CheckboxProps extends BaseProps, ToggleStateOptions, AriaCheckboxProps {}
```

åœ¨æˆ‘ä»¬ç»„ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™äº›å±æ€§ï¼Œä¾‹å¦‚`BadgeProps`ç»„ä»¶ä¸­æ˜¯è¿™æ ·çš„ï¼Œé€šè¿‡`types.ts`å¼•å…¥å±æ€§ã€‚
```tsx :BadgeProps.tsx
import './Badge.css'
import {cn} from '../cn'
import { BadgeProps } from '../../types'

function Badge(props: BadgeProps) {
    return <>
        <span className={ cn("badge-container", props.className) } style={{...props.style}}>
            {props.children}
        </span>
    </>
}
```

è€Œå¯¹äºä½¿ç”¨æ–¹æ¥è¯´ï¼Œåˆ™æ˜¯é€šè¿‡`index.d.ts`ï¼Œä¹Ÿå¯¹åº”äº†`pacakge.json`ä¸­çš„`types`å±æ€§é…ç½®ã€‚
```ts :index.d.ts
export * from './types';

declare module 'camel-ui' {
  export * from './types';
}
```
## 2.3 `vite.config.ts`ä¸`tsconfig.json`
éœ€è¦å…ˆå®‰è£…ä¸¤ä¸ªæ’ä»¶ï¼š
- `vite-plugin-dts`æ’ä»¶ç”¨æ¥ç”Ÿæˆ`.d.ts`ç±»å‹å£°æ˜çš„æ–‡ä»¶ï¼Œè¿™å¯¹äºreactç»„ä»¶åº“å¾ˆé‡è¦ï¼Œä»–ä¼šå¯¹æ¯ä¸ªç»„ä»¶éƒ½ç”Ÿæˆä¸€ä¸ªç±»å‹å£°æ˜çš„æ–‡ä»¶ï¼Œæ™ºèƒ½æç¤ºå¾ˆæœ‰ç”¨ï¼Œå¹¶ä¸”è¿˜ä¼šæ‹·è´ä¸Šé¢çš„`index.d.ts`æ–‡ä»¶ã€‚
- `vite-plugin-lib-inject-css`ç”¨æ¥å†…è¿`css`åˆ°`js`ä¸­ï¼Œä½¿å¾—åªå¼•å…¥`js`ç»„ä»¶ï¼Œå°±è‡ªå¸¦äº†æ ·å¼ï¼Œä¸éœ€è¦å†å¼•ä¸€æ¬¡`css`ã€‚å½“ç„¶å¦‚æœä½ æœ¬æ¥å°±ç”¨äº†`css-in-js`çš„æ–¹æ¡ˆï¼Œé‚£è¿™ä¸ªç»„ä»¶å¯èƒ½æ˜¯ä¸éœ€è¦çš„ã€‚
```bash
$ npm i -D vite-plugin-lib-inject-css vite-plugin-dts
```

æ¥ä¸‹æ¥æ˜¯æœ€é‡è¦çš„ä¿®æ”¹`vite.config.ts`ï¼Œé»˜è®¤çš„`build`è¡Œä¸ºæ˜¯ä»¥`index.html`ä¸ºå…¥å£ï¼Œæ‰“åŒ…å„ç§jsæ–‡ä»¶ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªwebé¡¹ç›®ã€‚ä½†æ˜¯ç»„ä»¶åº“ä¸åŒï¼Œæˆ‘ä»¬è¦é…ç½®`build`ä¸º`lib`ã€‚
```ts :vite.config.ts {3,4,9-12,15-26}
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react-swc'// è¿™é‡Œæˆ‘ç”¨çš„swcå¦‚æœviteé¡¹ç›®æ²¡é€‰swcçš„è¯ï¼Œåº”è¯¥æ˜¯å¦ä¸€ä¸ªæ’ä»¶
import { libInjectCss } from 'vite-plugin-lib-inject-css'
import dts from 'vite-plugin-dts';
import path from 'path';

export default defineConfig({
  plugins: [react(), 
    libInjectCss(), // å†…è¿css
    dts({           // ç”Ÿæˆæ‰€æœ‰ç»„ä»¶çš„dtså£°æ˜åˆ°dist/typesç›®å½•
      tsconfigPath: './tsconfig.json', // æŒ‡å®štsconfigæ–‡ä»¶
      outDir: 'dist/types',
    }),],

  build: {
    lib: {
      entry: path.resolve(__dirname, 'src/index.ts'),
      name: 'CamelUI',
      fileName: (format) => `camel.${format}.js` // é»˜è®¤è¾“å‡ºformatæœ‰ä¿©ï¼Œumdå’Œes
    },
    rollupOptions: {
      external: ['react', 'react-dom'], // æ’é™¤reactçš„æ‰“åŒ…ï¼Œå‡å°åŒ…ä½“ç§¯
      output: {
        globals: {
          react: 'React',
          'react-dom': 'ReactDOM'
        }
      }
    }
  }
});
```
ç„¶åæ˜¯`tsconfig.json`æ·»åŠ ä¸¤è¡Œã€‚
```diff :tsconfig.json {3,4}
{
    ...
+    "declaration": true,
+    "declarationDir": "./dist/types",
    ...
}
```
## 2.4 æ‰“åŒ…ä¸æœ¬åœ°æµ‹è¯•
```bash
$ npm run build
```
å¾—åˆ°`dist`ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œ`camel.{format}.js`æ˜¯å‰é¢é…ç½®çš„ä¸»è¦å…¥å£jsæ–‡ä»¶ï¼Œ`index.css`æ˜¯æ‰€æœ‰çš„æ ·å¼ï¼Œ`types`æ˜¯`dts`æ’ä»¶ç”Ÿæˆçš„å„ç§ç»„ä»¶å’Œå±æ€§å£°æ˜ã€‚
```
â””â”€â”€ ğŸ“dist
    â””â”€â”€ camel.es.js
    â””â”€â”€ camel.umd.js
    â””â”€â”€ index.css
    â””â”€â”€ ğŸ“types
        â””â”€â”€ App.d.ts
        â””â”€â”€ ğŸ“components
            â””â”€â”€ ğŸ“Badge
                â””â”€â”€ Badge.d.ts
            ...
            â””â”€â”€ BaseProps.d.ts
        â””â”€â”€ index.d.ts
        â””â”€â”€ main.d.ts
        â””â”€â”€ types.d.ts
```
åœ¨ä¸Šä¼ åˆ°`npm`ä¹‹å‰æœ€å¥½å…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹
```bash
# åœ¨å½“å‰ç»„ä»¶åº“ç›®å½•ä¸‹è¿è¡Œ
$ npm link

# ç„¶ååˆ°ä¸€ä¸ªæµ‹è¯•é¡¹ç›®ä¸­è¿è¡Œ
$ npm link @sunwu51/camel-ui # è¿™é‡Œæ¢æˆä½ çš„ç»„ä»¶åº“å
```
æ­¤æ—¶å°±ä¼šç›´æ¥æŠŠç»„ä»¶åº“çš„ç›®å½•ï¼Œé“¾æ¥åˆ°æµ‹è¯•é¡¹ç›®çš„`node_modules`ä¸­ï¼Œå°±å¯ä»¥æµ‹è¯•ä½¿ç”¨äº†ã€‚
## 2.5 å‘å¸ƒnpm
å¦‚æœæ²¡æœ‰npmè´¦å·ï¼Œå…ˆå»æ³¨å†Œä¸€ä¸ªï¼Œç„¶ååœ¨ç»„ä»¶åº“é¡¹ç›®ä¸‹ç™»å½•ã€‚
```bash
$ npm login #æ ¹æ®æç¤ºå®Œæˆç™»å½•

$ npm publish 
```
å‘å¸ƒå®Œæˆåï¼Œå³å¯åœ¨`npm`é¡µé¢ä¸­çœ‹åˆ°ï¼Œå¹¶ä¸”å› ä¸ºæ˜¯`public`çš„ï¼Œæ‰€ä»¥å…¶ä»–äººä¹Ÿå¯ä»¥æµè§ˆå’Œå®‰è£…ã€‚

![image](https://i.imgur.com/nru2rHH.png)