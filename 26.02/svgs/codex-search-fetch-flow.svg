<svg xmlns="http://www.w3.org/2000/svg" width="1720" height="980" viewBox="0 0 1720 980" role="img" aria-labelledby="title desc">
  <title id="title">Codex 天气查询流程图</title>
  <desc id="desc">客户端 Codex、LLM OpenAI 与 weather.com 的 3 步天气查询流程。客户端只与 LLM 交互一次，LLM 内部完成搜索与抓取。</desc>

  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f7fbff" />
      <stop offset="100%" stop-color="#eef7f2" />
    </linearGradient>
    <linearGradient id="nodeClient" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1f6feb" />
      <stop offset="100%" stop-color="#3b82f6" />
    </linearGradient>
    <linearGradient id="nodeLLM" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#0f766e" />
      <stop offset="100%" stop-color="#14b8a6" />
    </linearGradient>
    <linearGradient id="nodeWeb" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#155e75" />
      <stop offset="100%" stop-color="#06b6d4" />
    </linearGradient>

    <marker id="arrowBlue" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#2563eb" />
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#0f766e" />
    </marker>
    <marker id="arrowOrange" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#ea580c" />
    </marker>

    <style>
      text {
        font-family: "PingFang SC", "Microsoft YaHei", "Noto Sans CJK SC", sans-serif;
      }
      .lane {
        stroke: #d1d5db;
        stroke-width: 2;
        stroke-dasharray: 6 8;
      }
      .node {
        rx: 20;
        ry: 20;
        filter: drop-shadow(0px 8px 14px rgba(15, 23, 42, 0.15));
      }
      .node-title {
        fill: #ffffff;
        font-size: 24px;
        font-weight: 700;
        text-anchor: middle;
      }
      .node-sub {
        fill: #ffffff;
        font-size: 16px;
        font-weight: 500;
        text-anchor: middle;
        opacity: 0.92;
      }
      .legend {
        fill: #334155;
        font-size: 14px;
      }
      .step path {
        fill: none;
        stroke-width: 4;
        stroke-linecap: round;
        stroke-dasharray: 14 10;
        animation: flow 1.6s linear infinite;
      }
      .step text {
        font-size: 17px;
        font-weight: 600;
        fill: #0f172a;
      }
      .step-bg {
        fill: #ffffff;
        opacity: 0.86;
        rx: 8;
        ry: 8;
      }
      .step {
        opacity: 0.2;
        animation: reveal 9s linear infinite;
      }
      #s1 { animation-delay: 0s; }
      #s2 { animation-delay: 3s; }
      #s3 { animation-delay: 6s; }

      @keyframes flow {
        to { stroke-dashoffset: -96; }
      }
      @keyframes reveal {
        0% { opacity: 0.18; }
        10% { opacity: 1; }
        24% { opacity: 1; }
        35% { opacity: 0.18; }
        100% { opacity: 0.18; }
      }
    </style>
  </defs>

  <rect x="0" y="0" width="1720" height="980" fill="url(#bg)" />

  <text x="860" y="52" font-size="36" font-weight="800" fill="#0f172a" text-anchor="middle">
    Codex Search + Fetch 天气查询流程
  </text>
  <text x="860" y="84" font-size="18" font-weight="500" fill="#334155" text-anchor="middle">
    单轮交互：客户端请求一次，LLM 内部完成 Web Search + Fetch 并直接返回
  </text>

  <line class="lane" x1="260" y1="180" x2="260" y2="890" />
  <line class="lane" x1="860" y1="180" x2="860" y2="890" />
  <line class="lane" x1="1460" y1="180" x2="1460" y2="890" />

  <rect class="node" x="130" y="110" width="260" height="88" fill="url(#nodeClient)" />
  <text class="node-title" x="260" y="147">客户端</text>
  <text class="node-sub" x="260" y="176">codex</text>

  <rect class="node" x="730" y="110" width="260" height="88" fill="url(#nodeLLM)" />
  <text class="node-title" x="860" y="147">模型供应商</text>
  <text class="node-sub" x="860" y="176">LLM OpenAI</text>

  <rect class="node" x="1330" y="110" width="260" height="88" fill="url(#nodeWeb)" />
  <text class="node-title" x="1460" y="147">最终访问网站</text>
  <text class="node-sub" x="1460" y="176">weather.com</text>

  <g id="s1" class="step">
    <path d="M276 280 C 430 280, 674 280, 844 280" stroke="#2563eb" marker-end="url(#arrowBlue)" />
    <rect class="step-bg" x="370" y="254" width="500" height="30" />
    <text x="620" y="275" text-anchor="middle">1) 客户端请求 LLM：询问天气（tools 默认允许内建 web_search）</text>
  </g>

  <g id="s2" class="step">
    <path d="M876 436 C 1020 402, 1298 402, 1444 436" stroke="#ea580c" marker-end="url(#arrowOrange)" />
    <path d="M1444 482 C 1298 516, 1020 516, 876 482" stroke="#ea580c" marker-end="url(#arrowOrange)" />
    <rect class="step-bg" x="820" y="444" width="670" height="30" />
    <text x="1155" y="465" text-anchor="middle">2) LLM 判断需实时搜索，自动触发 web_search，并继续自动 fetch 相关 URL</text>
  </g>

  <g id="s3" class="step">
    <path d="M844 660 C 674 660, 430 660, 276 660" stroke="#0f766e" marker-end="url(#arrowGreen)" />
    <rect class="step-bg" x="300" y="666" width="640" height="30" />
    <text x="620" y="687" text-anchor="middle">3) LLM 汇总搜索与抓取结果后，直接返回天气信息给客户端（仅一次交互）</text>
  </g>

  <rect x="64" y="904" width="1592" height="48" rx="12" ry="12" fill="#ffffff" opacity="0.84" />
  <text class="legend" x="88" y="934">
    动画说明：箭头虚线持续流动；步骤按时间顺序循环高亮（1 → 3）。
  </text>
</svg>
